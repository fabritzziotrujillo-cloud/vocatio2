<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Resultados del Test - Vocatio</title>

  <!-- estilos globales -->
  <link rel="stylesheet" href="../../styles/global.css">
  <link rel="stylesheet" href="../../styles/style.css">

  <!-- estilos específicos -->
  <link rel="stylesheet" href="components/resultados-test.css">

  <!-- Lucide -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L4NYN4CHVR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L4NYN4CHVR');
</script>
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-container">
      <div class="logo">
        <div class="logo-icon">V</div>
        <span class="logo-text">Vocatio</span>
      </div>

     <div class="nav-items">
      <a href="../inicio.html" class="nav-link">
        <i data-lucide="home"></i>
        <span>Inicio</span>
      </a>
      <a href="../TestVocacional/test-vocacional-seccion.html" class="nav-link">
        <i data-lucide="clipboard-check"></i>
        <span>Test Vocacional</span>
      </a>
      <a href="../ExplorarCarreras/explorar-carreras-seccion.html" class="nav-link">
        <i data-lucide="search"></i>
        <span>Explorar Carreras</span>
      </a>
      <a href="../Perfil/perfil-seccion.html" class="nav-link active">
        <i data-lucide="user"></i>
        <span>Mi Perfil</span>
      </a>
    </div>

      <!-- Avatar + Nombre (reemplaza el botón de Iniciar Sesión) -->
<div id="nav-user" class="nav-user" style="position: relative; display:flex; align-items:center; gap:8px; cursor:pointer;">
  <div id="userAvatar" class="nav-user-circle" style="
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background-color: #5dade2; /* color si no hay foto */
      background-size: cover;
      background-position: center;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      color: white;
      font-size: 16px;
  ">U</div>

  <span id="userName" class="nav-user-name" style="font-weight: 600; color:#333;">Usuario</span>
</div>

    </div>

    <!-- Breadcrumb -->
    <div class="breadcrumb">
      <div class="breadcrumb-container">
        <a href="/pages/inicio.html" class="breadcrumb-link">
          <i data-lucide="home"></i>
          <span>Inicio</span>
        </a>
        <span class="breadcrumb-separator">/</span>
        <a href="test-vocacional-seccion.html" class="breadcrumb-link">
          <span>Test Vocacionales</span>
        </a>
        <span class="breadcrumb-separator">/</span>
        <span class="breadcrumb-current">Resultados</span>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="resultados-hero">
    <div class="resultados-hero-content">
      <div class="hero-icon"><i data-lucide="award"></i></div>
      <h1 class="hero-title">Resultados del Test</h1>
      <p class="hero-subtitle">Estas son tus compatibilidades por área vocacional.</p>
    </div>
  </section>

  <!-- Main -->
  <main class="resultados-main">
    <div class="resultados-container">

      <!-- resumen -->
      <div class="top-result-card" id="topAreaCard">
        <!-- JS lo llena -->
      </div>

      <!-- tabla de porcentajes -->
      <h2 class="section-title">Compatibilidades por Área</h2>
      <div class="areas-grid" id="areasGrid">
        <!-- JS lo llena -->
      </div>

      <!-- recomendaciones -->
      <h2 class="section-title">Carreras Recomendadas</h2>
      <div class="reco-container" id="recoContainer">
        <!-- JS lo llena -->
      </div>
<button id="guardarResultadosBtn" class="btn-save">
  <i data-lucide="save"></i>
  Guardar resultados
</button>


      <div class="actions">
        <a href="formulario-test.html" class="btn-secondary">Volver a realizar test</a>
      </div>

    </div>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2025 Vocatio. Todos los derechos reservados.</p>
    </div>
  </footer>

  <script src="/pages/TestVocacional/js/resultados-test.js"></script>
  <script> lucide.createIcons(); </script>
<script>
  document.getElementById('guardarResultadosBtn').addEventListener('click', () => {

    const compatibilidad = window.compatibilidadFinal || 92;
    const carreraPrincipal = window.carreraPrincipal || "Carrera no detectada";
    const duracion = window.duracionTest || "10 min";
    const fecha = new Date();

    // ============================================
    // 1. GUARDAR EL ÚLTIMO RESULTADO PARA LAS ESTADÍSTICAS
    // ============================================
    const resultado = {
      compatibilidadMax: compatibilidad,
      carreraMax: carreraPrincipal,
      fecha: fecha.toISOString()
    };

    localStorage.setItem(
      "ultimoResultadoVocacional",
      JSON.stringify(resultado)
    );

    // ============================================
    // 2. GUARDAR EN EL HISTORIAL GENERAL
    // ============================================
    let historialVoc = JSON.parse(localStorage.getItem("historialVocacional")) || [];
    historialVoc.push(resultado);
    localStorage.setItem("historialVocacional", JSON.stringify(historialVoc));

    // ============================================
    // (Tu historial anterior para historial-evaluaciones)
    // ============================================
    const nuevoTest = {
      id: Date.now(),
      numero: 1,
      fecha: fecha.toLocaleDateString(),
      hora: fecha.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
      duracion: duracion,
      compatibilidad: compatibilidad
    };

    let historial = JSON.parse(localStorage.getItem("historialTests")) || [];
    historial.push(nuevoTest);
    localStorage.setItem("historialTests", JSON.stringify(historial));

    // REDIRECCIÓN
    window.location.href = "test-vocacional-seccion.html";
  });
</script>


<script src="/pages/js/user-info.js"></script>

</body>
</html>
